(function(){function h(){return!b.ready?(k&&k("midibridge not ready!"),"midibridge not ready!"):!0}function u(){try{d=b.getObject("midibridge-applet")}catch(a){setTimeout(u,25)}}try{console.log("")}catch(y){console={log:function(){}}}var b={NOTE_OFF:128,NOTE_ON:144,POLY_PRESSURE:160,CONTROL_CHANGE:176,PROGRAM_CHANGE:192,CHANNEL_PRESSURE:208,PITCH_BEND:224,SYSTEM_EXCLUSIVE:240,MIDI_TIMECODE:241,SONG_POSITION:242,SONG_SELECT:243,TUNE_REQUEST:246,EOX:247,TIMING_CLOCK:248,START:250,CONTINUE:251,STOP:252,
ACTIVE_SENSING:254,SYSTEM_RESET:255,NOTE_NAMES_SHARP:"sharp",NOTE_NAMES_FLAT:"flat",NOTE_NAMES_SOUNDFONT:"soundfont",NOTE_NAMES_ENHARMONIC_SHARP:"enh-sharp",NOTE_NAMES_ENHARMONIC_FLAT:"enh-flat"},c=[];c[128]="NOTE OFF";c[144]="NOTE ON";c[160]="POLY PRESSURE";c[176]="CONTROL CHANGE";c[192]="PROGRAM CHANGE";c[208]="CHANNEL PRESSURE";c[224]="PITCH BEND";c[240]="SYSTEM EXCLUSIVE";c[241]="MIDI TIMECODE";c[242]="SONG POSITION";c[243]="SONG SELECT";c[244]="RESERVED";c[245]="RESERVED";c[246]="TUNE REQUEST";
c[247]="EOX";c[248]="TIMING CLOCK";c[249]="RESERVED";c[250]="START";c[251]="CONTINUE";c[252]="STOP";c[254]="ACTIVE SENSING";c[255]="SYSTEM RESET";var o={sharp:"C,C#,D,D#,E,F,F#,G,G#,A,A#,B".split(","),flat:"C,D&#9837;,D,E&#9837;,E,F,G&#9837;,G,A&#9837;,A,B&#9837;,B".split(","),soundfont:"C,Db,D,Eb,E,F,Gb,G,Ab,A,Bb,B".split(","),"enh-sharp":"B#,C#,C##,D#,D##,E#,F#,F##,G#,G##,A#,A##".split(","),"enh-flat":"D&#9837;&#9837;,D&#9837;,E&#9837;&#9837;,E&#9837;,F&#9837;,G&#9837;&#9837;,G&#9837;,A&#9837;&#9837;,A&#9837;,B&#9837;&#9837;,B&#9837;,C&#9837;".split(",")},
f=JSON.parse,p=null,k=null,q=null,d=null,i=!1,j=!1,e=!1,g=!0,v={},r=!1,m={},s=[];b.version="0.5.4";b.ready=!1;b.noteNameModus=b.NOTE_NAMES_SHARP;var w="midiapplet-"+b.version+".jar";b.init=function(a){for(var n in c){var l=parseInt(n);switch(l){case b.NOTE_OFF:case b.NOTE_ON:case b.POLY_PRESSURE:case b.CONTROL_CHANGE:case b.PROGRAM_CHANGE:case b.CHANNEL_PRESSURE:case b.PITCH_BEND:s.push(l);for(var d=0;16>d;d++)c[l+d]=c[n];break;default:s.push(l)}}if("function"===typeof a)p=a;else if("object"===typeof a){r=
a.debug;n=a.midiCommands||s;m={};for(var h=0;h<n.length;h++)switch(l=n[h],l){case b.NOTE_OFF:case b.NOTE_ON:case b.POLY_PRESSURE:case b.CONTROL_CHANGE:case b.PROGRAM_CHANGE:case b.CHANNEL_PRESSURE:case b.PITCH_BEND:for(d=0;16>d;d++)m[l+d]=1;break;default:m[l]=1}i=a.connectAllInputs;j=a.connectFirstInput;e=a.connectFirstOutput;g=a.connectAllInputsToFirstOutput;p=a.data;q=a.ready;k=a.error;switch(!0){case g:e=j=i=!1;g=!0;break;case i&&e:e=j=i=!1;g=!0;break;case i:i=!0;g=e=j=!1;break;case e&&j:i=!1;
e=j=!0;g=!1;break;case e&&i:e=j=i=!1;g=!0;break;case e:j=i=!1;e=!0;g=!1;break;case j:i=!1;j=!0;g=e=!1;break;case !1==g:g=!1;break;default:g=!0}r&&console.log(j,e,i,g,f,m)}if(navigator.javaEnabled())try{if(void 0===f)console.log("supported browsers: Firefox 3.5+, Chrome 4.0+, Safari 4.0+, Opera 10.5+, Internet Explorer 8.0+");else{var t=document.createElement("div");t.setAttribute("id","midibridge-java");a="";-1===navigator.userAgent.toLowerCase().indexOf("chrome")?(a=a+'<object tabindex="0" id="midibridge-applet" type="application/x-java-applet" height="1" width="1"><param name="codebase" value="java/" />'+
('<param name="archive" value="'+w+'" />'),a+='<param name="code" value="net.abumarkub.midi.applet.MidiApplet" /><param name="scriptable" value="true" /><param name="minJavaVersion" value="1.5" />Your browser needs the Java plugin to use the midibridge. You can download it <a href="http://www.java.com/en/" target="blank" title="abumarkub midibridge download java" rel="abumarkub midibridge download java">here</a></object>'):(a+='<applet id="midibridge-applet" code="net.abumarkub.midi.applet.MidiApplet.class" archive="'+
w+'" codebase="java" width="1" height="1">',a+='<param name="minJavaVersion" value="1.5"></applet>');t.innerHTML=a;document.body.appendChild(t)}}catch(o){k?k("supported browsers: Firefox 3.5+, Chrome 4.0+, Safari 4.0+, Opera 10.5+, Internet Explorer 8.0+"):console.log("supported browsers: Firefox 3.5+, Chrome 4.0+, Safari 4.0+, Opera 10.5+, Internet Explorer 8.0+")}else k?k("no java plugin found; install or enable the java plugin"):console.log("no java plugin found; install or enable the java plugin")};
b.msgFromJava=function(a){a=f(a);switch(a.msgId){case "upgrade-java":k?k("please upgrade your java plugin!"):console.log("please upgrade your java plugin!");break;case "midi-started":u();d&&(v=a.devices,b.ready=!0,i&&b.connectAllInputs(),j&&b.connectFirstInput(),e&&b.connectFirstOutput(),g&&b.connectAllInputsToFirstOutput(),q&&q("midibridge started"));break;case "midi-data":if(p){if(void 0===m[a.status]){r&&console.log("MIDI message intercepted",a.status,a.data1,a.data2,a.channel);break}p(new x(a))}break;
case "error":k&&k(a.code)}};b.sendMidiEvent=function(a,b,c,e){return h()?f(d.processMidiEvent(a,b,c,e)):!1};b.getDevices=function(){return v};b.refreshDevices=function(){return h()?f(d.getDevices()):!1};b.connectAllInputs=function(){return h()?f(d.connectAllInputs()):!1};b.connectFirstInput=function(){return h()?f(d.connectFirstInput()):!1};b.connectFirstOutput=function(){return h()?f(d.connectFirstOutput()):!1};b.connectAllInputsToFirstOutput=function(){return h()?f(d.connectAllInputsToFirstOutput()):
!1};b.addConnection=function(a,b,c){return h()?(c=void 0===c?[]:c,f(d.addConnection(a,void 0===b?-1:b,c))):!1};b.removeConnection=function(a,b){return h()?f(d.removeConnection(a,b)):!1};b.disconnectAll=function(){return h()?f(d.disconnectAll()):!1};b.loadBase64String=function(a){a.indexOf("data:audio/mid;base64,"===0)&&(a=a.replace("data:audio/mid;base64,",""));return f(d.loadBase64String(a))};b.playBase64String=function(a){return f(d.playBase64String(a))};b.loadMidiFile=function(a){return f(d.loadMidiFile(a))};
b.playMidiFile=function(a){return f(d.playMidiFile(a))};b.startSequencer=function(){d.startSequencer()};b.pauseSequencer=function(){d.pauseSequencer()};b.stopSequencer=function(){d.stopSequencer()};b.closeSequencer=function(){d.closeSequencer()};b.getSequencerPosition=function(){return d.getSequencerPosition()};b.setSequencerPosition=function(a){d.setSequencerPosition(a)};var x=function(){var a=function(a){this.data1=a.data1;this.data2=a.data2;this.status=a.status;this.status="0"===this.data2&&this.status==
b.NOTE_ON?b.NOTE_OFF:this.status;this.channel=a.channel;this.noteName=b.getNoteName(this.data1,b.noteNameModus);this.statusCode=b.getStatus(this.status);this.microsecond=a.microsecond;this.time=b.getNiceTime(this.microsecond)};a.prototype={toString:function(){var a;a=""+(this.noteName+" "+this.statusCode+" "+this.data1+" "+this.data2+" "+this.channel+" "+this.status);return a+=this.microsecond?this.microsecond+" "+this.time:""},toJSONString:function(){return this.microsecond?"{'notename':"+this.noteName+
", 'status':"+this.status+", 'data1':"+this.data1+", 'data2':"+this.data2+", 'microsecond':"+this.microsecond+", 'time':"+this.time+"}":"{'notename':"+this.noteName+", 'status':"+this.status+", 'data1':"+this.data1+", 'data2':"+this.data2+"}"}};return a}();b.MidiMessage=x;b.getNoteName=function(a,b){return o[b][a%12]+""+Math.floor(a/12-1)};b.getNoteNumber=function(a,b){var c=-1,a=a.toUpperCase(),d;for(d in o)for(var f=o[d],e=0,g=f.length;e<g;e++)if(f[e]===a){c=e;break}return-1===c?"invalid note name":
noteNumber=12+c+12*b};b.getStatus=function(a){return c[a]};b.getNiceTime=function(a){var b=a/1E3/1E3>>0,c=b/3600>>0,d=b%3600/60>>0,b=b%60,a=a/1E3-36E5*c-6E4*d-1E3*b+0.5>>0;return""+(0<c?c+":":"")+(0<c?10>d?"0"+d:d:d)+":"+(10>b?"0"+b:b)+":"+(0===a?"000":10>a?"00"+a:100>a?"0"+a:a)};b.getObject=function(a){var b=navigator.userAgent.toLowerCase();return-1!==b.indexOf("msie")||-1!==b.indexOf("webkit")?window[a]:document[a]};window.addEventListener||(window.addEventListener=function(a,b){window.attachEvent("onload",
b)});window.midiBridge=b})(window);